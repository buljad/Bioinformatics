#Задание 4#

Я использовал _wsl_ для работы с Linux

1. Скачал результат секвернирования [SRR31569776](https://www.ncbi.nlm.nih.gov/sra/?term=SRR31569776) с помощью команды

**prefetch SRR31569776**

из установленного набора инструментов sra-toolkit.

2. Затем я скачал референсный геном hg38.fa и сопутствующие файлы (.amb, .ann, .bwt, .pac, .sa)(в репозиторий его файлы не приложил, так как файл имеет большой размер)
3. Далее были установлены инструменты **FastQC**, **bwa** и **samtools** для дальнейшей работы

4. С помощью FastQC я разобрал SRR31569776 на два файла SRR31569776_1.fastq и SRR31569776_2.fastq для дальнейшего выравнивания ридов командой

**fastq-dump --split-files SRR31569776**

Файлы очень большие по размеру, поэтому не приложены в репозиторий.

5. Провел выравнивание ридов с помощью bwa командой

**bwa mem -t 4 hg38.fa SRR31569776_1.fastq SRR31569776_2.fastq > alignment.sam**

Флаг -t 4 помогает в ускорении обработки файлов, разделяя нагрузку на 4 физических ядра компьютера.

Далее остортировал файл выравнивания и перевел в бинарный формат: **alignment_sorted.bam**

6. Далее индексировал выравнивание и перевел его в бинарный формат для уменьшения размера файла и дальнейшей работы с ним

**samtools index alignment_sorted.bam** 

в файл alignment_sorted.bam.bai

7. Затем был написан скрипт script.py, который вызывает samtools flagstat, разбирает вывод и определяет, превышает ли процент картированных ридов пороговое значение. Скрипт выдает сообщение "OK" или "NOT OK" в зависимости от результата. 

8. Установлен фреймворк Common Workflow Language (CWL) с помощью pipx. Также добавлен путь ~/.local/bin в переменную окружения PATH.

9. Инструкция по установке CWL:

 - Установить pipx командой python3 -m pip install --user pipx.

 - Установить cwltool командой pipx install cwltool.

 - Убедиться, что путь ~/.local/bin добавлен в PATH.

10. Изучены базовые возможности CWL. Написан тестовый файл hello_world.cwl, который успешно выдает сообщение "Hello, CWL!".

11. Созданы файлы bwa-align.cwl, samtools-flagstat.cwl и workflow.cwl для реализации пайплайна, включающего шаги выравнивания ридов на референсный геном и анализа результатов с использованием samtools flagstat.
Пайплайн успешно протестирован с использованием cwltool.

12. Сгенерирована визуализация пайплайна с помощью команды:

**cwltool --print-dot workflow.cwl | dot -Tpng -o workflow.png**

Получен файл workflow.png, отображающий структуру пайплайна в виде направленного ациклического графа (DAG).

13. Визуализация выполнена с помощью инструмента dot из пакета Graphviz. DAG отражает потоки данных между шагами пайплайна, но не показывает циклов или обратных связей, что отличает его от классической блок-схемы алгоритма.

Вывод
Все этапы задания выполнены успешно. Результаты включают работающий пайплайн в формате CWL, скрипты для анализа качества картирования и визуализацию пайплайна.

